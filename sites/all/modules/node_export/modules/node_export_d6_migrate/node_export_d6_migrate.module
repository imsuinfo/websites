<?php

/**
 * @file
 * The Node export drupal 6 migrate module.
 *
 * Corrects nodes imported from Drupal 6.
 */

/**
 * Implements hook_node_export_import_alter().
 */
function node_export_d6_migrate_node_export_node_import_alter(&$node, $original_node) {
  // @todo: a better way to tell a node is from drupal 6?
  if (!is_array($node->body)) {
    node_export_d6_migrate_process_node_body($node, $original_node);
    node_export_d6_migrate_process_node_cck($node, $original_node);
    node_export_d6_migrate_process_node_taxonomy($node, $original_node);
  }
}

/**
 * Migrate the body field.
 *
 * The code in this function is from node_update_7006().
 */
function node_export_d6_migrate_process_node_body(&$node, $original_node) {
  $langcode = empty($original_node->language) ? LANGUAGE_NONE : $original_node->language;

<<<<<<< HEAD
  $node->language = $langcode;
  $node->body = array();

=======
>>>>>>> 8be8d58bb4b14bad9cb3d899f3e1783f4bd4ae45
  if (!empty($original_node->teaser) && $original_node->teaser != text_summary($original_node->body)) {
    $node->body[$langcode][0]['summary'] = $original_node->teaser;
  }

  // Do this after text_summary() above.
  $break = '';
  if (substr($original_node->body, 0, strlen($break)) == $break) {
    $original_node->body = substr($original_node->body, strlen($break));
  }
  $node->body[$langcode][0]['value'] = $original_node->body;
<<<<<<< HEAD
  $node->body[$langcode][0]['format'] = 'filtered_html'; // Force a filtered_format (this is line is a hack)
=======

  if (empty($original_node->body) && empty($original_node->format)) {
    $node->body[$langcode][0]['format'] = NULL;
  }
  elseif (!in_array($original_node->format, $sandbox['existing_text_formats'])) {
    $node->body[$langcode][0]['format'] = variable_get('filter_default_format', 1);
  }
  else {
    $node->body[$langcode][0]['format'] = $original_node->format;
  }
>>>>>>> 8be8d58bb4b14bad9cb3d899f3e1783f4bd4ae45
}

/**
 * Migrate CCK data.
 */
function node_export_d6_migrate_process_node_cck(&$node, $original_node) {
  if (module_exists('content')) {
    // @todo
  }
}

/**
 * Migrate taxonomy data.
 */
function node_export_d6_migrate_process_node_taxonomy(&$node, $original_node) {
  if (module_exists('taxonomy')) {
    // @todo
  }
<<<<<<< HEAD
}
=======
}
>>>>>>> 8be8d58bb4b14bad9cb3d899f3e1783f4bd4ae45
